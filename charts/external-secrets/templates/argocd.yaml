apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: argocd-secret-test
  namespace: default
spec:
  dataFrom:
    - find:
        conversionStrategy: Default
        decodingStrategy: None
        name:
          regexp: "{{ .Values.envType }}ArgoSsoClient.*"
  refreshInterval: "30s"
  secretStoreRef:
    name: argocd-backend
    kind: ClusterSecretStore
  target:
    creationPolicy: Owner
    name: argocd-secret-test
    template:
      data:
        oidc.azure.clientId: '{{ printf "%sArgoSsoClientId" .Values.envType | get . }}' #"{{ index . (printf "%sArgoSsoClientId" .Values.envType) }}"
        oidc.azure.clientSecret: '{{ printf "%sArgoSsoClientSecret" .Values.envType | get . }}'
      engineVersion: v2
      mergePolicy: Replace
      type: Opaque
