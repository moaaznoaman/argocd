---
{{- $files := .Files.Glob "dashboards/*" }}
{{- $fileList := list }}
{{- range $path, $file := $files }}
  {{- $fileList = append $fileList (dict "path" $path "file" $file) }}
{{- end }}

{{- $chunks := $fileList | chunk 3 }}
{{- range $i, $chunk := $chunks }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: filia-dashboards-configmap-{{ $i }}
  namespace: monitoring
  labels:
    grafana_dashboard: "filia"
data:
  {{- range $entry := $chunk }}
  {{- $filename := base $entry.path }}
  {{ $filename }}: |
{{ $entry.file | toString | nindent 4 }}
  {{- end }}
---
{{- end }}
