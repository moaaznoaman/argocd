# apiVersion: v1
# kind: ConfigMap
# metadata:
#   name: filia-dashboards-configmap
#   namespace: monitoring
#   labels:
#     grafana_dashboard: "filia"
# data:
#   {{- $files := .Files.Glob "dashboards/*" }}
#   {{- range $path, $file := $files }}
#   {{ $filename := base $path }}
#   {{ $filename }}: |
# {{- toString $file | nindent 4 }}
# {{- end }}

{{- $files := .Files.Glob "dashboards/*" }}
{{- $fileList := list }}
{{- range $path, $file := $files }}
  {{- $fileList = append $fileList (dict "path" $path "file" $file) }}
{{- end }}

{{- $chunks := $fileList | chunk 3 }}
{{- range $i, $chunk := $chunks }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: filia-dashboards-configmap-{{ $i }}
  namespace: monitoring
  labels:
    grafana_dashboard: "filia"
data:
  {{- range $chunk }}
  {{- $filename := base .path }}
  {{ $filename }}: |
{{ toString .file | nindent 4 }}
  {{- end }}
---
{{- end }}
